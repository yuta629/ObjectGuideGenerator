# InDesign オブジェクトガイド生成スクリプト 要件定義書・仕様書

- **バージョン:** 2.4.0 (下位互換性 安定版)
- **最終更新日:** 2025/06/09

## 1. 要件定義

### 1.1. 目的
InDesignでのDTP作業において、オブジェクトを基準としたガイドを手動で作成する手間を削減し、作業効率と精度を向上させる。Illustratorの「ガイドを作成」機能のような利便性をInDesignでも実現することを目標とする。

### 1.2. 背景
- オブジェクトの上下左右や中心に合わせてガイドを手動で引く作業は、時間がかかり、正確な操作が難しい場合がある。
- 複数のオブジェクトに対して、一度に複数のガイド（天・地・左右など）を生成したいというニーズはDTPの現場で頻繁に発生する。

### 1.3. 機能要件
| ID | 要件概要 | 詳細 |
| :--- | :--- | :--- |
| FR1 | **ガイド生成基準** | 選択されたオブジェクトのバウンディングボックス（`visibleBounds`）を基準としてガイドを生成できること。 |
| FR2 | **ガイド位置指定** | 以下の位置にガイドを生成するオプションを提供すること。<br>- 上辺、下辺、左辺、右辺<br>- 水平センター、垂直センター |
| FR3 | **複数オブジェクトの処理単位** | 複数のオブジェクトを選択した場合の処理方法を選択できること。<br>- **オブジェクトごと:** 各オブジェクトの境界に対して個別にガイドを生成する。<br>- **グループとして:** 選択した全オブジェクトを包含する単一の矩形を基準にガイドを生成する。 |
| FR4 | **レイヤー指定** | ガイドを生成するレイヤーを指定できるオプションを提供すること。<br>- **専用レイヤー:** 「生成ガイド」レイヤーを自動で作成、または使用する。<br>- **アクティブレイヤー:** 現在アクティブなレイヤーを使用する。 |
| FR5 | **重複ガイドの回避** | 一度のスクリプト実行において、同一座標にガイドが重複して生成されるのを自動的に回避すること。 |
| FR6 | **ユーザーインターフェース** | 上記の要件を設定するための、直感的なダイアログボックスを提供すること。 |
| FR7 | **完了通知** | 処理完了後、生成したガイドの本数をユーザーにダイアログで通知すること。 |

### 1.4. 非機能要件
| ID | 要件概要 | 詳細 |
| :--- | :--- | :--- |
| NFR1 | **オブジェクトの処理条件** | スクリプトが処理する**個々のオブジェクト**は、それが配置されている**単一のページ内**に完全に収まっている必要がある。この条件を満たさないオブジェクト（例：複数のページにまたがるオブジェクト）は処理対象外とする。 |
| NFR2 | **複数ページにわたる選択への対応** | 処理条件(NFR1)を満たすオブジェクトが、**複数の異なるページに点在して選択されている場合**でも、ページごとに独立して処理を行い、それぞれ適切なガイドを生成すること。 |
| NFR3 | **操作の取り消し** | スクリプトによる一連の処理を、InDesignの「取り消し（Undo）」機能で一度に元に戻せること。 |
| NFR4 | **互換性** | Adobe InDesign 2020 以降を推奨。下位互換性確保のため、必要な機能を補うPolyfillを内蔵しており、CS6などの古いバージョンでも動作可能。 |
| NFR5 | **エラーハンドリング** | ドキュメント未選択、オブジェクト未選択などの前提条件を満たさない場合に、エラーメッセージを表示して処理を安全に中断すること。 |

---

## 2. 仕様書

### 2.1. スクリプト概要
- **スクリプト名:** オブジェクトガイド生成スクリプト
- **バージョン:** 2.4.0 (下位互換性 安定版)
- **概要:** 選択したオブジェクトの境界や中心を基準に、InDesignのページガイドを自動生成する。
- **対応バージョン:** Adobe InDesign (CS6以降での動作を想定)

### 2.2. 機能仕様
#### 2.2.1. ガイド生成
- 選択された1つ以上の`PageItem`オブジェクトの`visibleBounds`（表示上の境界）を取得し、ガイドの位置を算出する。
- ユーザーがダイアログで指定した位置（上辺／下辺／左辺／右辺／水平/垂直センター）に対応するページガイドを生成する。

#### 2.2.2. 処理単位
- **オブジェクトごと:** 選択された各オブジェクトに対して、個別にガイド生成処理を繰り返す。
- **グループとして:** 選択されたオブジェクト群をページごとに分類する。各ページ上のオブジェクト群を包含する単一のバウンディングボックスを算出し、それを基準にガイドを生成する。

#### 2.2.3. レイヤー処理
- **専用レイヤーを作成:** 「生成ガイド」という名称のレイヤーを検索する。存在しない場合は新規作成し、そのレイヤーにガイドを生成する。存在する場合は既存のレイヤーを使用する。
- **上記オプションが無効の場合:** 現在アクティブなレイヤーにガイドを生成する。

#### 2.2.4. 重複ガイドの回避
- 一度のスクリプト実行中に、同一座標へのガイド生成を自動的に回避する。これにより、複数のオブジェクトの辺が揃っている場合でも、不要なガイドが重複して作成されることを防ぐ。

### 2.3. UI仕様
スクリプト実行時に、以下の設定項目を持つダイアログボックスが表示される。

- **処理対象 (ラジオボタン)**
  - `◎ グループとして`: 全体を一つの塊として扱う。
  - `○ オブジェクトごと` (デフォルト): 個々のオブジェクトを基準にする。
- **生成するガイド (チェックボックス)**
  - `☑ 上辺` (デフォルト)
  - `☑ 下辺` (デフォルト)
  - `□ 水平センター`
  - `☑ 左辺` (デフォルト)
  - `☑ 右辺` (デフォルト)
  - `□ 垂直センター`
- **オプション (チェックボックス)**
  - `☑ 専用レイヤーを作成（'生成ガイド'）` (デフォルト)
- **ボタン**
  - `OK`: 設定内容でスクリプトを実行する。
  - `キャンセル`: 処理を中断してダイアログを閉じる。

### 2.4. 操作フロー
1.  ユーザーがInDesign上でオブジェクトを選択し、スクリプトを実行する。
2.  スクリプトが前提条件（ドキュメントが開かれているか、オブジェクトが選択されているか）をチェックする。
3.  設定用ダイアログが表示される。
4.  ユーザーが設定を行い、「OK」ボタンをクリックする。
5.  スクリプトはページ内に完全に収まっているオブジェクトのみを抽出し、処理対象とする。
6.  指定された設定に基づき、重複を避けながらページガイドを生成する。
7.  処理完了後、「〇〇本のガイドを生成しました。」という完了メッセージを表示する。

### 2.5. 制限事項・注意事項
- **対象オブジェクト:** アンカー付きオブジェクトや、オブジェクトの一部がページの外にはみ出している場合、そのオブジェクトは処理対象外となります。
- **Undo:** スクリプトによる全処理は、`[Command/Ctrl] + Z`で一度に取り消すことができます。
- **互換性:** `Object.keys`および`Array.prototype.indexOf`をサポートしない古いバージョンのInDesign（CS6など）でも動作するよう、機能を補うPolyfillを内蔵しています。
